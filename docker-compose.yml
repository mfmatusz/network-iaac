version: '3.8'

networks:
  # Gateway DMZ
  gateway_dmz:
    ipam:
      config:
        - subnet: 10.1.0.0/24

  # Service X 
  service_x:
    ipam:
      config:
        - subnet: 10.2.0.0/24

  # DMZ #2
  dmz_2:
    ipam:
      config:
        - subnet: 10.2.2.0/24

  # Security Infrastructure
  security:
    ipam:
      config:
        - subnet: 10.2.1.0/24

  # Green Server
  green:
    ipam:
      config:
        - subnet: 10.3.0.0/24

  # Red Server
  red:
    ipam:
      config:
        - subnet: 10.4.0.0/24

  # Remote Office
  remote_office:
    ipam:
      config:
        - subnet: 192.168.0.0/24

services:
  # Main Firewall
  main_firewall:
    build:
      context: ./services/firewalls/main
      network: host
    privileged: true
    sysctls:
      - net.ipv4.ip_forward=1
    cap_add:
      - NET_ADMIN
      - NET_RAW
    networks:
      gateway_dmz:
        ipv4_address: 10.1.0.3
      service_x:
        ipv4_address: 10.2.0.3
      green:
        ipv4_address: 10.3.0.3
      red:
        ipv4_address: 10.4.0.3

  # Gateway DMZ
  gateway_firewall:
    build:
      context: ./services/firewalls/gateway
      network: host
    privileged: true
    sysctls:
      - net.ipv4.ip_forward=1
    cap_add:
      - NET_ADMIN
      - NET_RAW
    networks:
      gateway_dmz:
        ipv4_address: 10.1.0.2

  gateway_nids:
    build:
      context: ./services/nids/gateway
      network: host
    cap_add:
      - NET_ADMIN
    networks:
      gateway_dmz:
        ipv4_address: 10.1.0.20

  gateway_dns:
    build:
      context: ./services/dns/gateway
      network: host
    cap_add:
      - NET_ADMIN
    networks:
      gateway_dmz:
        ipv4_address: 10.1.0.30

  service_x_dns:
    build:
      context: ./services/dns/service_x
      network: host
    cap_add:
      - NET_ADMIN
    networks:
      service_x:
        ipv4_address: 10.2.0.30

  service_x_nids:
    build:
      context: ./services/nids/service_x
      network: host
    cap_add:
      - NET_ADMIN
    networks:
      service_x:
        ipv4_address: 10.2.0.10

  # DMZ #2
  dmz2_firewall:
    build:
      context: ./services/firewalls/dmz2
      network: host
    privileged: true
    sysctls:
      - net.ipv4.ip_forward=1
    cap_add:
      - NET_ADMIN
      - NET_RAW
    networks:
      dmz_2:
        ipv4_address: 10.2.2.2
      service_x:
        ipv4_address: 10.2.0.5

  vpn_controller:
    build:
      context: ./services/vpn_controller
      network: host
    cap_add:
      - NET_ADMIN
    networks:
      dmz_2:
        ipv4_address: 10.2.2.50

  # Security Infrastructure
  security_firewall:
    build:
      context: ./services/firewalls/security
      network: host
    privileged: true
    sysctls:
      - net.ipv4.ip_forward=1
    cap_add:
      - NET_ADMIN
      - NET_RAW
    networks:
      security:
        ipv4_address: 10.2.1.2
      service_x:
        ipv4_address: 10.2.0.4

  # Remote Office
  ro_firewall:
    build:
      context: ./services/firewalls/ro
      network: host
    privileged: true
    sysctls:
      - net.ipv4.ip_forward=1
    cap_add:
      - NET_ADMIN
      - NET_RAW
    networks:
      remote_office:
        ipv4_address: 192.168.0.2

  edr:
    build:
      context: ./services/security/edr
      network: host
    cap_add:
      - NET_ADMIN
    networks:
      security:
        ipv4_address: 10.2.1.10

  siem:
    build:
      context: ./services/security/siem
      network: host
    cap_add:
      - NET_ADMIN
    networks:
      security:
        ipv4_address: 10.2.1.30

  log_collector:
    build:
      context: ./services/security/log_collector
      network: host
    cap_add:
      - NET_ADMIN
    networks:
      security:
        ipv4_address: 10.2.1.20

  service_x_host1:
    build:
      context: ./services/hosts/service_x
      network: host
    cap_add:
      - NET_ADMIN
    networks:
      service_x:
        ipv4_address: 10.2.0.100

  service_x_host2:
    build:
      context: ./services/hosts/service_x
      network: host
    cap_add:
      - NET_ADMIN
    networks:
      service_x:
        ipv4_address: 10.2.0.101

  green_host1:
    build:
      context: ./services/hosts/green
      network: host
    cap_add:
      - NET_ADMIN
    networks:
      green:
        ipv4_address: 10.3.0.100

  green_host2:
    build:
      context: ./services/hosts/green
      network: host
    cap_add:
      - NET_ADMIN
    networks:
      green:
        ipv4_address: 10.3.0.101

  # Red Server Host
  red_firewall:
    build:
      context: ./services/firewalls/red
      network: host
    privileged: true
    sysctls:
      - net.ipv4.ip_forward=1
    cap_add:
      - NET_ADMIN
      - NET_RAW
    networks:
      red:
        ipv4_address: 10.4.0.2

  red_host1:
    build:
      context: ./services/hosts/red
      network: host
    cap_add:
      - NET_ADMIN
    networks:
      red:
        ipv4_address: 10.4.0.100

  red_host2:
    build:
      context: ./services/hosts/red
      network: host
    cap_add:
      - NET_ADMIN
    networks:
      red:
        ipv4_address: 10.4.0.101

  dmz2_host1:
    build:
      context: ./services/hosts/dmz2
      network: host
    cap_add:
      - NET_ADMIN
    networks:
      dmz_2:
        ipv4_address: 10.2.2.100

  dmz2_host2:
    build:
      context: ./services/hosts/dmz2
      network: host
    cap_add:
      - NET_ADMIN
    networks:
      dmz_2:
        ipv4_address: 10.2.2.101

  ro_host1:
    build:
      context: ./services/hosts/remote_office
      network: host
    cap_add:
      - NET_ADMIN
    networks:
      remote_office:
        ipv4_address: 192.168.0.100

  vulnerability_scanner:
    build:
      context: ./services/security/vulnerability_scanner
      network: host
    environment:
      - USERNAME=admin
      - PASSWORD=admin
    privileged: true
    cap_add:
      - NET_ADMIN
      - NET_RAW
    ports:
      - "8834:8834"
    networks:
      security:
        ipv4_address: 10.2.1.50
